<script th:fragment="js" th:inline="javascript" type="text/javascript">

    $(document).ready(function(){
        console.log("DOCUMENT 222READY!!");

        // 이벤트 핸들러 초기화(등록)
        init_like_events();
    });


    function init_like_events(){
        // 인테리어 상품 좋아요 / 좋아요 취소
        $(document).on('click','a.like_product_btn',function (e){
            e.preventDefault();
            let p_no = $(this).data("p_no");
            console.log("p_no ++++++" + p_no);
            let loginedMemberDto = [[${session.loginedMemberDto}]];
            if(loginedMemberDto == null){
                $('div.modal_wrap').css('display','block');
            }else{
                if($(this).find("img.full_heart").attr('class') == "full_heart"){
                    ajax_updateLikeCount("cancel", 1, p_no, loginedMemberDto.u_id);
                }else{
                    ajax_updateLikeCount("like", 1, p_no, loginedMemberDto.u_id);
                }

            }

        })

        // 커뮤니티 게시판 좋아요 / 좋아요 취소
        $(document).on('click','a.like_board_btn', function (e) {
            e.preventDefault();
            let b_no = $(this).data("b_no");
            console.log("b_no : " + b_no);

            let loginedMemberDto = [[${session.loginedMemberDto}]];
            if(loginedMemberDto == null){
                $('div.modal_wrap').css('display','block');
            }else{
                if($(this).find("img.full_heart").attr('class') == "full_heart"){
                    ajax_updateLikeCount("cancel", 2, b_no, loginedMemberDto.u_id);
                }else{
                    ajax_updateLikeCount("like", 2, b_no, loginedMemberDto.u_id);
                }

            }
        })

        // 유튜브 좋아요 / 좋아요 취소
        $(document).on('click','a.like_youtube_btn', function (e) {
            e.preventDefault();
            let y_no = $(this).data("y_no");
            console.log("y_no : " + y_no);

            let loginedMemberDto = [[${session.loginedMemberDto}]];
            if(loginedMemberDto == null){
                $('div.modal_wrap').css('display','block');
            }else{
                if($(this).find("img.full_heart").attr('class') == "full_heart"){
                    ajax_updateLikeCount("cancel", 3, y_no, loginedMemberDto.u_id);
                }else{
                    ajax_updateLikeCount("like", 3, y_no, loginedMemberDto.u_id);
                }

            }
        })

        // 마이 페이지 좋아요 취소
        $(document).on('click','a.user_like_board_btn', function (e) {
            e.preventDefault();
            let b_no = $(this).data("b_no");
            console.log("b_no : " + b_no);

            let loginedMemberDto = [[${session.loginedMemberDto}]];
            if(loginedMemberDto == null){
                $('div.modal_wrap').css('display','block');
            }else{
                ajax_decreaseLikeCount(2, b_no, loginedMemberDto.u_id);
            }
        })

        // 마이 페이지 상품 좋아요 취소
        $(document).on('click','a.user_like_product_btn', function (e) {
            e.preventDefault();
            let p_no = $(this).data("p_no");
            console.log("p_no : " + p_no);

            let loginedMemberDto = [[${session.loginedMemberDto}]];
            if(loginedMemberDto == null){
                $('div.modal_wrap').css('display','block');
            }else{
                ajax_decreaseLikeCount(1, p_no, loginedMemberDto.u_id);
            }
        })

        // 유튜브 좋아요 취소
        $(document).on('click','a.like_youtube_btn', function (e) {
            e.preventDefault();
            let y_no = $(this).data("y_no");
            console.log("y_no : " + y_no);

            let loginedMemberDto = [[${session.loginedMemberDto}]];
            if(loginedMemberDto == null){
                $('div.modal_wrap').css('display','block');
            }else{
                ajax_decreaseLikeCount(3, y_no, loginedMemberDto.u_id);
            }
        })
    }

    function ajax_decreaseLikeCount(type, no, u_id){
        console.log('ajax_decreaseLikeCount() CALLED!!');

        let msgDto = {
            'type': type,
            'no': no,
            'u_id' : u_id
        };

        $.ajax({
            url: '/like/decrease_like_confirm',
            method: 'POST',
            data: JSON.stringify(msgDto),
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                console.log('AJAX SUCCESS - ajax_decreaseLikeCount()');

                switch (type){
                    case 1:
                        ajax_LikeProductList(pageNum)
                        ajax_MainBoardList();
                        break;
                    case 2:
                        ajax_LikeBoardList(sort, pageNum, keyword)
                        ajax_MainProductList();
                        break;
                    case 3:
                        ajax_MainYoutubeList();
                        break;
                }

            },
            error: function(data) {
                console.log('AJAX ERROR - ajax_decreaseLikeCount()');

            }
        });
    }

   function ajax_updateLikeCount(method, type, no, u_id){
       console.log('ajax_updateLikeCount() CALLED!!');

       let msgDto = {
           'method' : method,
           'type': type,
           'no': no,
           'u_id' : u_id
       };

       let str = '/like/like_confirm';
       $.ajax({
           url: str,
           method: 'POST',
           data: JSON.stringify(msgDto),
           contentType: 'application/json; charset=utf-8',
           success: function(data) {
               console.log('AJAX SUCCESS - ajax_updateLikeCount()');

               switch (type){
                   case 1:
                       reconProductTdForLike(data.productDto, data.isLike);
                       break;
                   case 2:
                       reconBoardTdForLike(data.boardDto, data.isLike)
                       break;
                   case 3:
                       reconYoutubeTdForLike(data.boardDto, data.isLike)
                       break;
               }

           },
           error: function(data) {
               console.log('AJAX ERROR - ajax_updateLikeCount()');

           }
       });
   }

</script>




